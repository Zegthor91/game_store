{% extends 'base.html.twig' %}

{% block title %}Commande {{ order.orderNumber }} - Game Store{% endblock %}

{% block body %}
<nav aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{{ path('app_home') }}">Accueil</a></li>
        <li class="breadcrumb-item"><a href="{{ path('app_order_history') }}">Mes commandes</a></li>
        <li class="breadcrumb-item active">{{ order.orderNumber }}</li>
    </ol>
</nav>

<h1 class="mb-4">Commande {{ order.orderNumber }}</h1>

<div class="row">
    <div class="col-md-8">
        <div class="card mb-4">
            <div class="card-header bg-dark text-white">
                <h5 class="mb-0">Informations de la commande</h5>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-md-6">
                        <strong>Numéro :</strong> {{ order.orderNumber }}
                    </div>
                    <div class="col-md-6">
                        <strong>Date :</strong> {{ order.createdAt|date('d/m/Y à H:i') }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Statut :</strong>
                        {% set status_class = {
                            'pending': 'warning',
                            'paid': 'info',
                            'shipped': 'primary',
                            'delivered': 'success',
                            'cancelled': 'danger'
                        } %}
                        <span class="badge bg-{{ status_class[order.status] ?? 'secondary' }}">
                            {% if order.status == 'pending' %}En attente
                            {% elseif order.status == 'paid' %}Payée
                            {% elseif order.status == 'shipped' %}Expédiée
                            {% elseif order.status == 'delivered' %}Livrée
                            {% elseif order.status == 'cancelled' %}Annulée
                            {% else %}{{ order.status }}
                            {% endif %}
                        </span>
                    </div>
                    <div class="col-md-6">
                        <strong>Montant total :</strong> <span class="text-success fs-5 fw-bold">{{ order.totalAmount }} €</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h5 class="mb-0">Articles commandés</h5>
            </div>
            <div class="card-body">
                {% for item in order.orderItems %}
                    <div class="row align-items-center mb-3 pb-3 border-bottom">
                        <div class="col-md-7">
                            <h6 class="mb-1">{{ item.game.title }}</h6>
                            <small class="text-muted">{{ item.game.platform }}</small>
                        </div>
                        <div class="col-md-2 text-center">
                            <strong>x {{ item.quantity }}</strong>
                        </div>
                        <div class="col-md-3 text-end">
                            <strong class="text-success">{{ item.unitPrice * item.quantity }} €</strong>
                        </div>
                    </div>
                {% endfor %}
                <div class="text-end">
                    <strong>Total : <span class="fs-4 text-success">{{ order.totalAmount }} €</span></strong>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="card mb-3">
            <div class="card-header">
                <h5 class="mb-0">Suivi de la commande</h5>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li class="mb-2">
                        <i class="bi bi-check-circle-fill text-success"></i> Commande passée
                        <br><small class="text-muted">{{ order.createdAt|date('d/m/Y H:i') }}</small>
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-{{ order.status in ['paid', 'shipped', 'delivered'] ? 'check-circle-fill text-success' : 'circle text-muted' }}"></i> Paiement confirmé
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-{{ order.status in ['shipped', 'delivered'] ? 'check-circle-fill text-success' : 'circle text-muted' }}"></i> Expédition
                    </li>
                    <li class="mb-2">
                        <i class="bi bi-{{ order.status == 'delivered' ? 'check-circle-fill text-success' : 'circle text-muted' }}"></i> Livraison
                    </li>
                </ul>
            </div>
        </div>

        <a href="{{ path('app_order_history') }}" class="btn btn-outline-primary w-100">
            <i class="bi bi-arrow-left"></i> Retour à mes commandes
        </a>
    </div>
</div>
{% endblock %}